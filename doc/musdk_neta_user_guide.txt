NETA IO User Guide
==================

Introduction
------------

MUSDK NETA driver and test applications are part of the whole MUSDK package and
applicable for A3700 platforms.

MUSDK NETA driver provides capability of usage NETA HW unit directly from user-space
applications with minimum overhead and high performance.

Supported Features
------------------

NETA initialization
~~~~~~~~~~~~~~~~~~~
::

	int neta_init(struct neta_init_params *params);

- Initialize the global NETA resources.
- Fields in "struct neta_init_params" are:
	- bm_pool_reserved_map - buffer manager pools reserved by kernel space.

NETA shutdown
~~~~~~~~~~~~~
::

	int neta_deinit(void);

- Destroy NETA driver and free global resources.

BM Pool
~~~~~~~
APIs to work with BM pools:

	- neta_bpool_init
	- neta_bpool_deinit
	- neta_bpool_get_buff
	- neta_bpool_put_buffs
	- neta_bpool_put_buff
	- neta_bpool_get_num_buffs

PPIO
~~~~
	Init:
		- neta_ppio_init
		- neta_ppio_deinit
		- neta_ppio_enable
		- neta_ppio_disable

	Send/Receive:
		- neta_ppio_send
		- neta_ppio_recv
		- neta_ppio_get_num_outq_done

	Filtering:
		- Not supported.

	Outqueue:
		- Support all neta_ppio_outq_xxx API's

	Inqueue:
		- Support all neta_ppio_inq_xxx API's

	Statistics:
		- Not supported.


Source Tree
------------

Sources::

    musdk/
	- src/include/driver/	- public include files for NETA driver
		- mv_neta.h
		- mv_neta_ppio.h
		- mv_neta_bpool.h

	- src/driver/neta/	- NETA driver implementation
		- neta.c
		- neta_hw.h
		- neta_hw.c
		- neta_ppio.h
		- neta_ppio.c
		- neta_bm.h
		- neta_bm.c

	- apps/examples/neta/pkt_echo/	- is a basic forwarding application supplied with MUSDK framework
		- pkt_echo.c

Binaries:
	- libmusdk.a		- MUSDK APIs implementation library
	- musdk_pkt_echo	- simple test application


NETA Test Applications
----------------------
To run MUSDK NETA test applications, mv_neta_uio.ko kernel modules must be loaded before.
For more details please refer to musdk_get_started.txt chapter "5. Insert kernel modules".

musdk_pkt_echo
~~~~~~~~~~~~~~~
Basic configuration for Armada-37x0 DB, both ports belong to User Space::

		> ifconfig eth0 up
		> ifconfig eth1 up
		> sleep 1
		> insmod musdk_uio.ko
		> insmod mv_neta_uio.ko

Command parameters:

	Usage: musdk_pkt_echo OPTIONS

	Mandatory OPTIONS::

		-i, --interface <Eth-interfaces> (comma-separated, no spaces, min 1, max 2)

	Optional OPTIONS::

		-b <size>                Burst size, num_pkts handled in a batch. Currently not supported.
					 (default is 256)
		--mtu <mtu>              Set MTU (default is 1500). Currently not supported.
		-c, --cores <number>     Number of CPUs to use
		-s                       Maintain statistics. Currently not supported.
		--rxq <size>             Size of rx_queue. Currently not supported. (default is 512)
		--cli                    Use CLI. Currently not supported.
		?, -h, --help            Display help and exit.

    Limitations:
	- It is assumed the interface is brought up in Linux before being used by musdk_pkt_echo.
	- No RSS support.


    Example for single core::

	> ./musdk_pkt_echo -i eth0

    Example for single core and two ports::

	> ./musdk_pkt_echo -i eth0,eth1

    Example for two core and two ports::

	> ./musdk_pkt_echo -i eth0,eth1 -c 2


